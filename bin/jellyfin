#!/usr/bin/env bash
set -Eeuo pipefail

if ((EUID != 0)); then
    echo 'Super-user privileges are required to run Docker on Synology.' >&2
    exit 1
fi

COMPOSE_PROJECT_NAME=$(basename "${BASH_SOURCE[0]}")
export COMPOSE_PROJECT_NAME

if (($# == 1)) && [[ "$1" == up ]]; then
    DOCKER_UID=$(id -u Richard)
    VIDEO_GID=$(grep video /etc/group | cut -d: -f3)
    export DOCKER_UID VIDEO_GID
    set -- up --detach jellyfin
fi

exec docker-compose "$@"
